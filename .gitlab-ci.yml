image: node:latest

stages:
  - build
  - test
  - deploy
  - release

build:
  stage: build
  script:
    - yarn install
    - yarn build:locales && yarn build:js

  artifacts:
    paths:
      - dist/

deploy:
  stage: deploy
  script:
    - echo "lodger:registry=https://gitlab.example.com/api/v4/packages/npm/" > ~/.npmrc
    - echo "//gitlab.example.com/api/v4/packages/npm/:_authToken=${CI_JOB_TOKEN}" > ~/.npmrc
    - echo "//gitlab.com/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${NPM_TOKEN}" > ~/.npmrc
    - echo "//<npm-registry>:8080/:_authToken=${NPM_TOKEN}" > ~/.npmrc
    - npm publish --access=public
